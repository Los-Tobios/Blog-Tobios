<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>Tobios&#39; Blog</title>
  
  <subtitle>Backups</subtitle>
  <link href="https://los-tobios.github.io/blog-tobios/atom.xml" rel="self"/>
  
  <link href="https://los-tobios.github.io/blog-tobios/"/>
  <updated>2022-06-22T14:05:23.407Z</updated>
  <id>https://los-tobios.github.io/blog-tobios/</id>
  
  <author>
    <name>Tobios</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>一个自动连接重邮校园网的小技巧</title>
    <link href="https://los-tobios.github.io/blog-tobios/2022/06/22/xiaoyuanwang_autologin/"/>
    <id>https://los-tobios.github.io/blog-tobios/2022/06/22/xiaoyuanwang_autologin/</id>
    <published>2022-06-22T13:29:51.000Z</published>
    <updated>2022-06-22T14:05:23.407Z</updated>
    
    <content type="html"><![CDATA[<h2 id="登陆原理"><a href="#登陆原理" class="headerlink" title="登陆原理"></a>登陆原理</h2><p>学校是web登陆认证，只需发送一个GET请求即可。想要做到自动登陆，难点在于获取ip和判断脚本执行的时机。</p><h2 id="脚本"><a href="#脚本" class="headerlink" title="脚本"></a>脚本</h2><h3 id="linux-shell"><a href="#linux-shell" class="headerlink" title="linux shell"></a>linux shell</h3><p>需要使用<code>ifconfig</code>命令获取ip，以arch系为例，需要安装<code>net-tools</code><br>校园网分配的ip都是10.开头的，所以可一用<code>grep &#39;inet 10.&#39;</code>，当然如果主机存在其他以10.开头的ip，可能会产生干扰，后续可考虑加入判断条件。<br>当然你也可以用其他方式获取ip</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#author tobios</span></span><br><span class="line"></span><br><span class="line">device=1<span class="comment">#奇数为手机端，偶数为pc端口</span></span><br><span class="line">operator=cmcc<span class="comment">#移动为cmcc,电信为ctcc</span></span><br><span class="line">user_account=<span class="string">&#x27;这里替换成用户名&#x27;</span></span><br><span class="line">user_password=<span class="string">&#x27;这里替换成密码&#x27;</span></span><br><span class="line">ip=`ifconfig | grep <span class="string">&#x27;inet 10.&#x27;</span> | awk <span class="string">&#x27;&#123;print$2&#125;&#x27;</span>`</span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;当前ip为：<span class="variable">$ip</span>&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;开始连接&quot;</span></span><br><span class="line"></span><br><span class="line">flag=`curl -s <span class="string">&quot;http://192.168.200.2:801/eportal/?c=Portal&amp;a=login&amp;callback=dr1003&amp;login_method=1&amp;user_account=%2C<span class="variable">$device</span>%2C<span class="variable">$user_account</span>%40<span class="variable">$operator</span>&amp;user_password=<span class="variable">$user_password</span>&amp;wlan_user_ip=<span class="variable">$ip</span>&amp;wlan_user_ipv6=&amp;wlan_user_mac=000000000000&amp;wlan_ac_ip=&amp;wlan_ac_name=&amp;jsVersion=3.3.3&amp;v=9863&quot;</span>`</span><br><span class="line"></span><br><span class="line"><span class="comment"># echo $flag</span></span><br><span class="line"></span><br><span class="line">flag_ok=<span class="string">&#x27;dr1003(&#123;&quot;result&quot;:&quot;1&quot;,&quot;msg&quot;:&quot;\u8ba4\u8bc1\u6210\u529f&quot;&#125;)&#x27;</span></span><br><span class="line">flag_reget=<span class="string">&#x27;dr1003(&#123;&quot;result&quot;:&quot;0&quot;,&quot;msg&quot;:&quot;&quot;,&quot;ret_code&quot;:2&#125;)&#x27;</span></span><br><span class="line">flag_error=<span class="string">&#x27;dr1003(&#123;&quot;result&quot;:&quot;0&quot;,&quot;msg&quot;:&quot;bGRhcCBhdXRoIGVycm9y&quot;,&quot;ret_code&quot;:1&#125;)&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> [ <span class="string">&quot;<span class="variable">$flag</span>&quot;</span> = <span class="string">&quot;<span class="variable">$flag_ok</span>&quot;</span> ]</span><br><span class="line"><span class="keyword">then</span></span><br><span class="line">        <span class="built_in">echo</span> <span class="string">&quot;认证成功&quot;</span></span><br><span class="line"><span class="keyword">elif</span> [ <span class="string">&quot;<span class="variable">$flag</span>&quot;</span> = <span class="string">&quot;<span class="variable">$flag_error</span>&quot;</span> ]</span><br><span class="line"><span class="keyword">then</span></span><br><span class="line">        <span class="built_in">echo</span> <span class="string">&quot;认证失败&quot;</span></span><br><span class="line"><span class="keyword">elif</span> [ <span class="string">&quot;<span class="variable">$flag</span>&quot;</span> = <span class="string">&quot;<span class="variable">$flag_reget</span>&quot;</span> ]</span><br><span class="line"><span class="keyword">then</span></span><br><span class="line">        <span class="built_in">echo</span> <span class="string">&quot;已连接，请勿重复操作&quot;</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">        <span class="built_in">echo</span> <span class="variable">$flag</span> <span class="comment">#还存在其他的返回，懒得罗列了，一般都是这三</span></span><br><span class="line"><span class="keyword">fi</span></span><br></pre></td></tr></table></figure><p>如果你使用ifupdown配置网络，可以将脚本添加到<code>/etc/network/interfaces</code>中</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">up bash -e 这里写脚本目录</span><br></pre></td></tr></table></figure><ul><li>这里的 pre-up ,up,down,post-down为网卡启动的钩子</li><li>pre-up  对应的为 网络启动之前执行脚本</li><li>up         对应网络启动之后执行脚本</li><li>down    网络关闭之间</li><li>post-down  网络关闭之后</li></ul><p>可以通过systemd来设置开机启动服务，来对每次开机时再网络开启之后执行一次脚本命令，</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/systemd/system/autologin.service</span><br></pre></td></tr></table></figure><p>写入以下内容</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[Unit]</span></span><br><span class="line"><span class="attr">Description</span>=test networking</span><br><span class="line"><span class="comment">#Before=network.target</span></span><br><span class="line"><span class="attr">After</span>=NetworkManager.service <span class="comment"># 网络启动之后,这里以NetworkManager为例，请替换成你所使用的网络管理服务</span></span><br><span class="line"><span class="section">[Service]</span></span><br><span class="line"></span><br><span class="line"><span class="attr">Type</span>=<span class="literal">on</span>eshot <span class="comment"># 执行一次</span></span><br><span class="line"><span class="attr">ExecStart</span>=/bin/bash -e  这里替换成脚本路径</span><br><span class="line"><span class="attr">KillSignal</span>=SIGINT</span><br><span class="line"><span class="section">[Install]</span></span><br><span class="line"><span class="attr">WantedBy</span>=multi-user.target <span class="comment">#多用户模式 </span></span><br></pre></td></tr></table></figure><p>亦或者加入crontab中</p><h3 id="Windows-CMD"><a href="#Windows-CMD" class="headerlink" title="Windows CMD"></a>Windows CMD</h3><p>win10以下需要额外安装curl<br>当然也可以选择用其他工具发get请求</p><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line">@<span class="built_in">echo</span> off</span><br><span class="line">::author tobios</span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">rem 请修改config中的信息</span></span><br><span class="line"><span class="comment">rem ConfigStart</span></span><br><span class="line"><span class="built_in">set</span> &quot;device=<span class="number">1</span>&quot;::奇数为手机端，偶数为pc端口</span><br><span class="line"><span class="built_in">set</span> &quot;operator=cmcc&quot;::移动为cmcc,电信为ctcc</span><br><span class="line"><span class="built_in">set</span> &quot;user_account=这里替换成用户名&quot;</span><br><span class="line"><span class="built_in">set</span> &quot;user_password=这里替换成密码&quot;</span><br><span class="line"><span class="comment">rem ConfigEnd</span></span><br><span class="line"></span><br><span class="line">:GetIP</span><br><span class="line"><span class="keyword">for</span> /f &quot;tokens=<span class="number">2</span> delims=:(&quot; <span class="variable">%%i</span> <span class="keyword">in</span> (&#x27;<span class="built_in">ipconfig</span> /all ^|<span class="built_in">findstr</span> &quot;IPv4&quot; ^|<span class="built_in">findstr</span> &quot;<span class="number">10</span>.&quot;&#x27;) <span class="keyword">do</span> (</span><br><span class="line">    <span class="built_in">set</span> &quot;IP=<span class="variable">%%i</span>&quot;</span><br><span class="line">    <span class="keyword">goto</span> :ShowIP</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">:ShowIP</span><br><span class="line"><span class="built_in">set</span> &quot;IP=%IP: =%&quot;</span><br><span class="line"><span class="keyword">if</span> &quot; =&quot;==&quot;<span class="variable">%IP%</span>&quot; (</span><br><span class="line"><span class="built_in">echo</span> 错误，请检查网络连接情况</span><br><span class="line">) <span class="keyword">else</span> (</span><br><span class="line"><span class="built_in">echo</span> 当前ip为：<span class="variable">%ip%</span></span><br><span class="line"><span class="built_in">echo</span> 开始连接</span><br><span class="line"><span class="keyword">goto</span> :Login</span><br><span class="line">)</span><br><span class="line"><span class="keyword">goto</span> :<span class="keyword">Exit</span></span><br><span class="line"></span><br><span class="line">:Login</span><br><span class="line"><span class="keyword">for</span> /f <span class="variable">%%i</span> <span class="keyword">in</span> (&#x27;curl -s &quot;http://<span class="number">192</span>.<span class="number">168</span>.<span class="number">200</span>.<span class="number">2</span>:<span class="number">801</span>/eportal/?c=Portal&amp;a=login&amp;callback=dr1003&amp;login_method=<span class="number">1</span>&amp;user_account=<span class="variable">%%2</span>C<span class="variable">%device%</span><span class="variable">%%2</span>C<span class="variable">%user_account%</span><span class="variable">%%4</span>0<span class="variable">%operator%</span>&amp;user_password=<span class="variable">%user_password%</span>&amp;wlan_user_ip=<span class="variable">%ip%</span>&amp;wlan_user_ipv6=&amp;wlan_user_mac=<span class="number">000000000000</span>&amp;wlan_ac_ip=&amp;wlan_ac_name=&amp;jsVersion=<span class="number">3</span>.<span class="number">3</span>.<span class="number">3</span>&amp;v=<span class="number">9863</span>&quot;&#x27;) <span class="keyword">do</span> (</span><br><span class="line">    <span class="built_in">set</span> &quot;flag=<span class="variable">%%i</span>&quot;</span><br><span class="line">    <span class="keyword">goto</span> :ShowResult</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">:ShowResult</span><br><span class="line"><span class="built_in">set</span> &quot;flag_ok=dr1003(&#123;&quot;result&quot;:&quot;<span class="number">1</span>&quot;,&quot;msg&quot;:&quot;\u8ba4\u8bc1\u6210\u529f&quot;&#125;)&quot;</span><br><span class="line"><span class="built_in">set</span> &quot;flag_reget=dr1003(&#123;&quot;result&quot;:&quot;<span class="number">0</span>&quot;,&quot;msg&quot;:&quot;&quot;,&quot;ret_code&quot;:<span class="number">2</span>&#125;)&quot;</span><br><span class="line"><span class="built_in">set</span> &quot;flag_error=dr1003(&#123;&quot;result&quot;:&quot;<span class="number">0</span>&quot;,&quot;msg&quot;:&quot;bGRhcCBhdXRoIGVycm9y&quot;,&quot;ret_code&quot;:<span class="number">1</span>&#125;)&quot;</span><br><span class="line"><span class="keyword">if</span> &quot;<span class="variable">%flag%</span>&quot;==&quot;<span class="variable">%flag_ok%</span>&quot; (</span><br><span class="line"><span class="built_in">echo</span> 认证成功</span><br><span class="line"><span class="keyword">goto</span> :<span class="keyword">Exit</span></span><br><span class="line">) <span class="keyword">else</span> <span class="keyword">if</span>  &quot;<span class="variable">%flag%</span>&quot;==&quot;<span class="variable">%flag_error%</span>&quot; (</span><br><span class="line"><span class="built_in">echo</span> 认证失败</span><br><span class="line"><span class="keyword">goto</span> :<span class="keyword">Exit</span></span><br><span class="line">) <span class="keyword">else</span> <span class="keyword">if</span>  &quot;<span class="variable">%flag%</span>&quot;==&quot;<span class="variable">%flag_reget%</span>&quot; (</span><br><span class="line"><span class="built_in">echo</span> 已连接，请勿重复操作</span><br><span class="line"><span class="keyword">goto</span> :<span class="keyword">Exit</span></span><br><span class="line">)</span><br><span class="line"><span class="built_in">echo</span> <span class="variable">%flag%</span></span><br><span class="line"></span><br><span class="line">:<span class="keyword">Exit</span></span><br><span class="line"><span class="built_in">pause</span></span><br></pre></td></tr></table></figure><p>接下来实现连接WiFi自动运行脚本<br>这里借鉴于知乎</p><ol><li>打开任务计划程序<br><img src="http://www.sonder.tk:88/pictures/xiaoyuanwang_autologin/image_1.jpg" alt="image.jpg"></li><li>点击右侧‘创建任务’，名称、描述按自己喜好写<br><img src="http://www.sonder.tk:88/pictures/xiaoyuanwang_autologin/image_2.jpg" alt="image.jpg"></li><li>点击触发器选项并点击新建<br><img src="http://www.sonder.tk:88/pictures/xiaoyuanwang_autologin/image_3.jpg" alt="image.jpg"></li><li>选择开始任务为发生事件时，并选择自定义、点击新建事件筛选器<br><img src="http://www.sonder.tk:88/pictures/xiaoyuanwang_autologin/image_4.jpg" alt="image.jpg"></li><li>点击xml并勾选手动编辑查询，替换为以下内容，后点确定<br><img src="http://www.sonder.tk:88/pictures/xiaoyuanwang_autologin/image_5.jpg" alt="image.jpg"><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">QueryList</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">Query</span> <span class="attr">Id</span>=<span class="string">&quot;0&quot;</span> <span class="attr">Path</span>=<span class="string">&quot;Microsoft-Windows-WLAN-AutoConfig/Operational&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">Select</span> <span class="attr">Path</span>=<span class="string">&quot;Microsoft-Windows-WLAN-AutoConfig/Operational&quot;</span>&gt;</span>*[System[(EventID=8001)]][EventData[Data[@Name=&#x27;SSID&#x27;]=&#x27;CQUPT&#x27;] or EventData[Data[@Name=&#x27;SSID&#x27;]=&#x27;CQUPT-2.4G&#x27;] or EventData[Data[@Name=&#x27;SSID&#x27;]=&#x27;CQUPT-5G&#x27;]]<span class="tag">&lt;/<span class="name">Select</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">Query</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">QueryList</span>&gt;</span></span><br></pre></td></tr></table></figure></li><li>然后点击操作选项并点击新建<br><img src="http://www.sonder.tk:88/pictures/xiaoyuanwang_autologin/image_6.jpg" alt="image.jpg"></li><li>选择操作为‘启动程序’，并选择脚本的位置，然后确定<br><img src="http://www.sonder.tk:88/pictures/xiaoyuanwang_autologin/image_7.jpg" alt="image.jpg"></li><li>如果你使用笔记本电脑，需要额外关注‘条件’中的‘电源’选项<br><img src="http://www.sonder.tk:88/pictures/xiaoyuanwang_autologin/image_8.jpg" alt="image.jpg"></li><li>最后点击确定就ok了</li></ol><p>未完待续</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;登陆原理&quot;&gt;&lt;a href=&quot;#登陆原理&quot; class=&quot;headerlink&quot; title=&quot;登陆原理&quot;&gt;&lt;/a&gt;登陆原理&lt;/h2&gt;&lt;p&gt;学校是web登陆认证，只需发送一个GET请求即可。想要做到自动登陆，难点在于获取ip和判断脚本执行的时机。&lt;/p&gt;
&lt;h2 </summary>
      
    
    
    
    
    <category term="技巧" scheme="https://los-tobios.github.io/blog-tobios/tags/%E6%8A%80%E5%B7%A7/"/>
    
    <category term="校园网" scheme="https://los-tobios.github.io/blog-tobios/tags/%E6%A0%A1%E5%9B%AD%E7%BD%91/"/>
    
    <category term="shell" scheme="https://los-tobios.github.io/blog-tobios/tags/shell/"/>
    
    <category term="计划任务" scheme="https://los-tobios.github.io/blog-tobios/tags/%E8%AE%A1%E5%88%92%E4%BB%BB%E5%8A%A1/"/>
    
  </entry>
  
</feed>
